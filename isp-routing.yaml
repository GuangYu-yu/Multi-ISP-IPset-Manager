allow-lan: true
ipv6: true

geo-auto-update: true
geo-update-interval: 8

dns:
  enable: true
  listen: 0.0.0.0:53
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query

geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb"
  asn: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb"

profile:
  store-selected: true

tcp-concurrent: true

proxies:
  - name: "移动"
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-cmcc
    udp: true
    routing-mark: 1

  - name: "联通"
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-cnc
    udp: true
    routing-mark: 2

  - name: "电信"
    type: direct
    ip-version: ipv6-prefer
    interface-name: pppoe-ct
    udp: true
    routing-mark: 3

proxy-groups:
  - name: "国内"
    type: select
    proxies:
      - 移动
      - 联通
      - 电信
      - 一致性哈希
      - 会话保持
      - 轮询
    health-check:
      enable: true
      url: https://www.qq.com/favicon.ico
      interval: 300
      timeout: 5000
      lazy: false

  - name: "一致性哈希"
    type: load-balance
    strategy: consistent-hashing
    proxies:
      - 移动
      - 联通
      - 电信
    health-check:
      enable: true
      url: https://www.qq.com/favicon.ico
      interval: 300
      timeout: 5000
      lazy: false

  - name: "会话保持"
    type: load-balance
    strategy: sticky-sessions
    proxies:
      - 移动
      - 联通
      - 电信
    health-check:
      enable: true
      url: https://www.qq.com/favicon.ico
      interval: 300
      timeout: 5000
      lazy: false

  - name: "轮询"
    type: load-balance
    strategy: round-robin
    proxies:
      - 移动
      - 联通
      - 电信
    health-check:
      enable: true
      url: URL_ADDRESS.qq.com/favicon.ico
      interval: 300
      timeout: 5000
      lazy: false
      
  - name: "漏网之鱼"
    type: select
    proxies:
      - 移动
      - 联通
      - 电信
      - 一致性哈希
      - 会话保持
      - 轮询

rule-providers:
  中国移动v4:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/cmcc.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/cmcc.yaml
  中国移动v6:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/cmcc6.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/cmcc6.yaml
  中国联通v4:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/unicom.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/unicom.yaml
  中国联通v6:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/unicom6.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/unicom6.yaml
  中国电信v4:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/chinanet.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/chinanet.yaml
  中国电信v6:
    type: http
    url: "https://gaoyifan.github.io/china-operator-ip/chinanet6.txt"
    interval: 86400
    behavior: ipcidr
    format: text
    path: ./ruleset/chinanet6.yaml

  移动ASN:
    type: http
    url: "https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/mobile_asn.yaml"
    interval: 86400
    behavior: classical
    format: yaml
    path: ./ruleset/mobile_asn.yaml

  联通ASN:
    type: http
    url: "https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/unicom_asn.yaml"
    interval: 86400
    behavior: classical
    format: yaml
    path: ./ruleset/unicom_asn.yaml

  电信ASN:
    type: http
    url: "https://cdn.jsdelivr.net/gh/GuangYu-yu/chinaisp-cidr@main/telecom_asn.yaml"
    interval: 86400
    behavior: classical
    format: yaml
    path: ./ruleset/telecom_asn.yaml

rules:
  - DOMAIN-SUFFIX,jsdelivr.net,DIRECT
  - DOMAIN-SUFFIX,github.io,DIRECT

  # IP分流
  - RULE-SET,中国移动v4,移动
  - RULE-SET,中国移动v6,移动
  - RULE-SET,中国联通v4,联通
  - RULE-SET,中国联通v6,联通
  - RULE-SET,中国电信v4,电信
  - RULE-SET,中国电信v6,电信

  # ASN分流
  - RULE-SET,移动ASN,移动
  - RULE-SET,联通ASN,联通
  - RULE-SET,电信ASN,电信

  # 直连
  - GEOIP,LAN,DIRECT
  - GEOIP,CN,国内
  - MATCH,漏网之鱼